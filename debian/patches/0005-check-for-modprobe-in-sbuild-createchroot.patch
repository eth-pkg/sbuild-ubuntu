From af00d5790b4fa694e46e8bb8e9d547a6ed347c98 Mon Sep 17 00:00:00 2001
From: Johannes 'josch' Schauer <josch@mister-muffin.de>
Date: Sun, 22 Jan 2017 14:51:56 +0100
Subject: [PATCH 5/5] check for modprobe in sbuild-createchroot

---
 bin/sbuild-createchroot | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/bin/sbuild-createchroot b/bin/sbuild-createchroot
index 4cd79aa7..2d2bbe4a 100755
--- a/bin/sbuild-createchroot
+++ b/bin/sbuild-createchroot
@@ -364,9 +364,9 @@ EOF
 } else {
     # Determine whether system has overlayfs capability
     my $uniontype = "none";
-    if (lc("$^O") =~ /linux/) {
-	system(qw(/sbin/modprobe overlay));
-	if (open(FILE, "/proc/filesystems")) {
+    if (lc("$^O") =~ /linux/ && -e '/sbin/modprobe') {
+	my $ret = system(qw(/sbin/modprobe overlay));
+	if ($ret == 0 && open(FILE, "/proc/filesystems")) {
 	    if (grep {/\soverlay$/} <FILE>) {
 		$uniontype = "overlay";
 	    }
-- 
2.11.0

