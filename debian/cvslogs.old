Thu Sep 16 11:34:43 CEST 2004

 This is the old (now obsolete) log contents of roman CVS repository.
 We missed a few changes after, unfortunately.
 
 	Francesco P. Lovergine <frankie@debian.org>


# Revision 1.169  2002/03/11 09:49:55  rnhodek
# chroot_apt_options: don't just set Dir::Etc::sourcelist, but whole
# Dir::Etc, to avoid new preferences.
#
# Revision 1.168  2002/02/07 09:12:25  rnhodek
# Fixed sudo call for running scripts.
#
# Revision 1.167  2002/01/22 08:53:10  rnhodek
# Use capitalized "Noninteractive" das DEBIAN_FRONTENT.
#
# Revision 1.166  2001/11/08 09:32:10  rnhodek
# fetch_source_file: in case of apt, need to pass up a $dscfile with
# epoch stripped.
#
# Revision 1.165  2001/11/07 18:04:31  rnhodek
# Argl.. I should learn perl first :)
#
# Revision 1.164  2001/11/07 09:25:59  rnhodek
# fetch_source_files: after apt-get, fix $dscfile not to contain epoch.
#
# Revision 1.163  2001/11/06 15:11:24  rnhodek
# fetch_source_files: don't touch symlinks generated by apt-get.
#
# Revision 1.162  2001/11/06 12:29:22  rnhodek
# New config var $use_FetchFile (default 0).
# Integrated patches for using apt-get to download sources; modified so
#   that old code (using FetchFile.pm) still present.
# run_apt: Fix parsing error of apt-output (\s matched ^M printed by
#   pre-configuring).
#
# Revision 1.161  2001/10/29 12:20:41  rnhodek
# Added $fakeroot var.
#
# Revision 1.160  2001/10/29 08:27:53  rnhodek
# Fix typo in message.
#
# Revision 1.159  2001/06/18 09:57:55  rnhodek
# Use --database option when wanna_build_dbbase set in config.
#
# Revision 1.158  2001/06/01 09:54:36  rnhodek
# Fix two typos.
#
# Revision 1.157  2001/05/31 08:08:08  rnhodek
# Fixed thinko in conflicts checking (tnx James)
#
# Revision 1.156  2001/05/30 08:20:05  rnhodek
# Use /var/lib/apt as Dir::State if exists (newer apt versions use that)
# (tnx to Ryan Murray).
#
# Revision 1.155  2001/05/30 08:17:01  rnhodek
# Print also architecture at start of log.
#
# Revision 1.154  2001/05/29 07:33:54  rnhodek
# Also handle versioned Build-Conflicts.
#   (Tnx to David Schleef <ds@schleef.org>)
#
# Revision 1.153  2001/03/13 08:45:17  rnhodek
# Run chmod -R on source tree only after unpacking.
#
# Revision 1.152  2001/02/19 09:23:24  rnhodek
# Fix typo.
#
# Revision 1.151  2001/02/19 08:43:22  rnhodek
# Fix wrong arch logic.
#
# Revision 1.150  2001/01/22 12:56:16  rnhodek
# Fix handling of arch-restricted build-deps (tnx to Ryan Murray).
#
# Revision 1.149  2001/01/15 11:17:36  rnhodek
# Fixed typo.
#
# Revision 1.148  2001/01/15 10:59:18  rnhodek
# Shortcut when looking for non-dsc files: first try to fetch from same
# dir as .dsc and FF_search only if that fails.
#
# Revision 1.147  2001/01/10 16:16:48  rnhodek
# Move all built files from chroot dir, not only *.deb.
#
# Revision 1.146  2000/10/23 10:39:24  rnhodek
# Before doing chmod on /etc/ld.so.conf, test if it exists at all.
#
# Revision 1.145  2000/10/19 09:08:35  rnhodek
# A couple of little fixes from Ben.
# Checks and assures that /etc/ld.so.conf is readable.
# Support for local overrides with $conf::srcdep_over.
#
# Revision 1.144  2000/06/27 12:34:00  rnhodek
# Implemented new 'prepre' and 'unpack' sections for special targets;
# the first is a script run before package installation, and the latter
# can list source packages that should be unpacked in the build dir.
#
# Revision 1.143  2000/06/20 14:39:59  rnhodek
# Call apt-get with some options for relocating various files instead of
# chrooting it; this avoids that the archive must be available in chroot
# environment; same is true for dpkg and apt-cache calls.
# If chrooted, call dpkg with the chroot dir as cwd to avoid "cannot get
# current directory" errors; same for apt option DPkg::Run-Directory.
#
# Revision 1.142  2000/06/19 14:09:00  rnhodek
# Fix syntax error.
#
# Revision 1.141  2000/06/19 14:05:38  rnhodek
# Call buildd-addpkg with --chroot=DIR options for each dist that is >=
# the one building for (to run apt-get update in the chroot
# environments).
#
# Revision 1.140  2000/06/19 09:10:24  rnhodek
# Obey new config var @ignore_watches_no_build_deps, i.e. don't flag
# watches that are listed there if the package doesn't have build deps.
# In check_watches(), strip $chroot_dir instead of $chroot_build_dir
# from pathname.
#
# Revision 1.139  2000/06/13 10:54:43  rnhodek
# Also execute special dependency scripts in chroot environment.
#
# Revision 1.138  2000/06/09 12:47:52  rnhodek
# File .dsc filename for rbuilder (with URL).
#
# Revision 1.137  2000/06/09 09:15:21  rnhodek
# Always install built package (if already) when building chroot; i.e.
# the $system_level test is not necessary when chrooted.
#
# Revision 1.136  2000/06/09 08:20:52  rnhodek
# Fixed su usage in sub build.
#
# Revision 1.135  2000/06/08 14:02:11  rnhodek
# After changing to chroot dir, change back to be the normal user again
# and start dpkg-buildpackage with -rsudo again; some packages require
# that the build target is executed as non-root.
#
# Revision 1.134  2000/06/08 13:01:54  rnhodek
# apt-cache calls need sudo, too, when using chroot.
#
# Revision 1.133  2000/06/08 09:13:31  rnhodek
# Implemented chroot builds; there are a few new global variables
# $main::chroot_*; major changes are in build, where the source tree is
# unpacked somewhere else, dpkg-buildpackage called under chroot and
# built packages are moved back again; also all apt-get and dpkg calls
# are chroot-ed and /var/lib/dpkg/status is accessed from the chroot
# environment; also watches are checked under the new root dir.
#
# Revision 1.132  2000/06/06 14:37:05  rnhodek
# New option --source (-s): Also build source package, i.e. don't pass
# -b or -B to dpkg-buildpackage.
#
# Revision 1.131  2000/05/30 15:41:34  rnhodek
# Call buildd-addpkg with --dist option.
# Install freshly built packages only if $conf::system_level >= $dist.
#
# Revision 1.130  2000/05/16 12:34:20  rnhodek
# Insert a chmod -R go+rX on the build tree to make files readable; it
# happens sometimes that files in a .orig.tar.gz have restrictive
# permissions and this can be inconvenient.
#
# Revision 1.129  2000/03/01 14:43:34  rnhodek
# Also match error message "dpkg: status database area is locked" from
# apt and retry call later.
#
# Revision 1.128  2000/02/16 15:21:33  rnhodek
# Fix a print message in merge_pkg_build_deps.
#
# Revision 1.127  2000/02/16 15:20:38  rnhodek
# Print version number of sbuild in package log.
#
# Revision 1.126  2000/02/16 15:15:15  rnhodek
# Fix regexp for finding !needs-no-XXX packages.
# Move !needs-no-XXX from central deps to $main::additional_deps so that
# they can be found by prepare_watches later.
#
# Revision 1.125  2000/02/15 14:40:35  rnhodek
# Remove forgotten debugging code.
#
# Revision 1.124  2000/02/15 11:12:43  rnhodek
# Expand virtual packages in package build dependencies for comparing
# with central deps.
#
# Revision 1.123  2000/02/11 11:17:07  rnhodek
# Do not activate watches for packages XXX if a negative dependency
# needs-no-XXX exists (used to be just a comment, now really processed
# by sbuild.)
# Also do not activate watches for dependencies of pkg build deps.
#
# Revision 1.122  2000/02/09 15:57:25  rnhodek
# In merge_pkg_build_deps, do not show warnings about missing
# !this-package-does-not-exist or !needs-no-xxx dependencies.
#
# Revision 1.121  2000/02/04 14:04:18  rnhodek
# Use --no-down-propagation.
#
# Revision 1.120  2000/02/01 12:05:56  rnhodek
# In binNMU mode, a '_' was missing in the job name.
#
# Revision 1.119  2000/01/28 14:54:43  rnhodek
# Accept abbrevs for distribution options (-ds, -df, -du) here, too.
# New option --make-binNMU=entry.
# New binNMU hack to modify debian/changelog; it will add a new entry
# for the NMU version.
# New helper function binNMU_version to generate a new version number.
#
# Revision 1.118  2000/01/13 14:32:30  rnhodek
# For compiling on slink systems, pass the --force-confold option to
# dpkg only for versions < 1.4.1.18 (that don't understand it yet).
#
# Revision 1.117  1999/12/17 13:49:50  rnhodek
# Improved output about missing central deps: build-essential (act.
# policy) and dependencies of pkg build deps are filtered out and
# printed separately.
# New functions cmp_dep_lists, read_build_essential,
# expand_dependencies, and get_dependencies for the above.
#
# Revision 1.116  1999/12/17 11:04:43  rnhodek
# When pkg build-deps were read from debian/sbuild-build-deps, a wrong
# package name was used.
#
# Revision 1.115  1999/12/09 09:54:42  rnhodek
# Again fixed a fatal typo...
#
# Revision 1.114  1999/12/08 12:33:16  rnhodek
# merge_pkg_build_deps: Fix printing of overrides.
#
# Revision 1.113  1999/12/08 12:25:34  rnhodek
# Special dependencies are implicitly overrides, i.e. are added to the
# package-provided build deps.
#
# Revision 1.112  1999/12/08 11:31:38  rnhodek
# get_dpkg_status: don't reset $res{$pkg}->{Installed} to 0 if $pkg is
# provided.
#
# Revision 1.111  1999/12/08 10:37:33  rnhodek
# Change parsing of .dsc file so that multi-line build dependencies are
# allowed.
# Make warning about missing central deps a bit bigger.
#
# Revision 1.110  1999/12/06 15:00:33  rnhodek
# Fix comparison with old deps (must copy them, not only the reference).
#
# Revision 1.109  1999/12/06 08:35:53  rnhodek
# Fixed typo.
#
# Revision 1.108  1999/12/03 09:58:16  rnhodek
# If a pkg has its own build deps, compare them with the central ones
# and report missing ones.
#
# Revision 1.107  1999/11/30 13:54:38  rnhodek
# Print a message if build deps from the .dsc are used (to avoid confusion).
# If a pkg has build deps, store them in debian/.sbuild-build-deps to
# have them available when rebuilding later (no .dsc anymore); also
# check for this file and read deps from it if building without a .dsc
# in unpacked source.
#
# Revision 1.106  1999/11/15 12:30:15  rnhodek
# merge_pkg_build_deps: added missing if $main::debug.
#
# Revision 1.105  1999/11/03 14:56:32  rnhodek
# When running apt, set env var DEBIAN_FRONTEND to noninteractive to
# stop debconf from asking questions or complaining that /dev/tty can't
# be opened.
#
# Revision 1.104  1999/11/02 16:43:51  rnhodek
# check_inst_packages: also upgrade dependencies of src-deps (if they're
# already installed); some -dev packages fail to correctly require an
# identical versioned shlib pkg, so in some cases only the -dev pkg was
# installed.
#
# Revision 1.103  1999/11/02 15:45:43  rnhodek
# build: Use epoch-stripped version number for the .changes file.
# check_inst_packages: forgot a if $main::debug.
#
# Revision 1.102  1999/10/29 13:07:49  rnhodek
# New option --stats-dir=DIR; if used, a "1" is appended to
# DIR/give-back each time a package is given back.
#
# Revision 1.101  1999/10/29 12:32:24  rnhodek
# If using an already unpacked source tree, check (with
# dpkg-parsechangelog) if it's really the requested version.
# Make apt-get run dpkg with --force-confold, as the </dev/null trick
# doesn't work anymore with dpkg >= 1.4.1.18.
#
# Revision 1.100  1999/10/25 12:12:21  rnhodek
# check_inst_packages: Add packages to @deps_inst only if they're not
# already to be installed.
#
# Revision 1.99  1999/10/22 09:01:36  rnhodek
# Minor changes to output of check_inst_packages.
#
# Revision 1.98  1999/10/21 14:21:57  rnhodek
# Oops... call check_inst_packages only if build was successful.
#
# Revision 1.97  1999/10/21 11:46:50  rnhodek
# Deleted RCS logs for < 1.50.
# New option --store-built-packages.
# Fix package name parsing: \w also matches '_' which is unwanted;
# replace by a-zA-Z.
# Read reverse sourcedeps of $main::store_built_packages.
# New sub check_inst_packages.
#
# Revision 1.96  1999/09/27 11:18:10  rnhodek
# Added a missing PLOG.
#
# Revision 1.95  1999/09/15 09:10:25  rnhodek
# Additionally print a warning if a special dep has a version relation.
#
# Revision 1.94  1999/09/15 09:08:12  rnhodek
# Changed parsing of dependencies a bit so that special deps can have
# arch restrictions, too.
#
# Revision 1.93  1999/08/30 09:44:35  rnhodek
# get_dpkg_status: don't exit too early if a pkg isn't in the arg list,
# as it might be provided only.
#
# Revision 1.92  1999/08/27 13:32:04  rnhodek
# --auto-give-back has a new optional argument, the user and hostname
# where to call wanna-build (like $conf::sshcmd); this is needed that
# sbuild can do give-backs when there's no local wanna-build.
#
# Revision 1.91  1999/08/23 12:53:02  rnhodek
# Support for alternatives.
# Support for [ARCH1 !ARCH2] arch restriction on dependencies.
# Parses only src-deps which are needed for packages to be built.
# Reads Build-{Depends,Conflicts}{,-Indep}: fields from .dsc if present;
# those override the central src-deps, except those marked as override
# (& prefix).
# Implemented abbrevs as kind of macros in src-deps.
# New option --add-depends (-a).
# New option --arch-all (-A).
#
# Revision 1.90  1999/08/11 15:28:11  rnhodek
# Insert missing wait call in run_script to get correct return value.
#
# Revision 1.89  1999/08/10 14:01:49  rnhodek
# Virtual packages as dependencies didn't work really yet -- the
# consistency check didn't see them (dpkg --status doesn't know them)
# and thus aborted the build; solution: get_dpkg_status now directly
# reads the status file (which should be a bit faster, too) and extracts
# Provides: fields of all installed packages and considers those virtual
# packages installed, too.
# Print "Source-dependencies not satisfied" message to package log, not
# to sbuild log.
# Same in run_apt for virtual package handling.
# Fix stdout/stderr redirecting when running scripts.
#
# Revision 1.88  1999/07/13 07:23:55  rnhodek
# Use GDBM for time/space databases, as perl-5.004 seems not to contain
# DB_File anymore.
#
# Revision 1.87  1999/06/21 12:52:00  rnhodek
# Seems apt has a new error message if a cached Packages file isn't
# up-to-date anymore -- recognize this msg, too, and reun apt-get update.
#
# Revision 1.86  1999/06/09 15:05:38  rnhodek
# Fix loop in apply_patches.
# Don't fail due to failed patch if a global patch.
# Global patches are no syntax error when parsing src-deps...
#
# Revision 1.85  1999/06/04 09:47:02  rnhodek
# Add support for global patches, which will be tried on any package;
# their names in source-dependencies start with "**".
#
# Revision 1.84  1999/06/04 08:17:17  rnhodek
# When calling wanna-build --give-back, don't forget the --dist argument!
# Added support for virtual packages as source dependencies: apt-get tells us
# which alternatives are possible, and one of these is selected either by
# %conf::alternatives or by random.
#
# Revision 1.83  1999/06/02 09:07:47  rnhodek
# With --batch, write each finished job to SBUILD-FINISHED; buildd can pick up
# this file if sbuild crashes and needs not rebuild already done stuff. The file
# is removed on normal exit and if sbuild dumps to REDO during a shutdown.
#
# Revision 1.82  1999/06/02 08:47:39  rnhodek
# Remove as many die's as possible -- the bad exit status can cause
# buildd to retry all packages of an sbuild run; better let this one
# package fail.
# Make sure that after build() we're in the correct directory: some
# chdir()s were missing; also don't chdir("..") because this can be
# wrong if we followed a symlink, use $main::cwd instead.
# If the package directory already exists as a symlink, abort the build.
#
# Revision 1.81  1999/05/31 12:59:41  rnhodek
# Run du after build under sudo, to avoid error messages about
# unreadable dirs.
#
# Revision 1.80  1999/05/27 13:28:04  rnhodek
# Oops, missed an epoch fix (when constructing the .changes file name).
#
# Revision 1.79  1999/05/26 11:34:11  rnhodek
# Ignore epochs for fetching files.
#
# Revision 1.78  1999/05/26 09:48:23  rnhodek
# If dpkg-source fails, remove .tmp-nest dir.
#
# Revision 1.77  1999/05/05 07:56:51  rnhodek
# Need to empty %main::this_watches before filling it for a new package;
# otherwise we have some spurious reports :-)
#
# Revision 1.76  1999/05/04 14:51:40  rnhodek
# Some more minor stuff for avg-build-space: Reset global
# $main::this_space to 0 before each build to avoid using the figure of
# the previous package in case of errors; don't write a 0 value into the
# database.
#
# Revision 1.75  1999/05/04 14:43:01  rnhodek
# Fix parsing of a single dependency: package name never should contain
# a '('.
#
# Revision 1.74  1999/05/04 14:29:51  rnhodek
# Determine how much space is required for a build (final build dir +
# generated .debs) after dpkg-buildpackage is finished; display figure
# in package log and also store it in $conf::avg_space_db (analogous to
# avg_time_db).
#
# Revision 1.73  1999/05/03 12:53:25  rnhodek
# After unpacking src dir, run "chmod -R g-s ." on it; some
# .orig.tar.gz's are packed with the setgid bit, which causes the debian
# dir and all subdirs to be created setgid, too, and later dpkg-deb
# --build complains about this.
#
# Revision 1.72  1999/04/22 14:16:25  rnhodek
# Don't kill tee process if verbose but --nolog set -- $pkg_tee_pid
# undefined then!
#
# Revision 1.71  1999/04/21 14:54:10  rnhodek
# Implemented watches if certain binaries have been used during a build
# without a source dependency.
#
# Revision 1.70  1999/03/12 10:29:32  rnhodek
# New option --force-depends (-f) to override src-deps of a package.
#

